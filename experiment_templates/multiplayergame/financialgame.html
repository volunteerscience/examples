
	
<table border="0" id="step1" class="financialgametable" align="center" width="800" height="600">
    <tr>
        <td width="800" colspan="5" height="8"></td>
    </tr>
    <tr>
        <td width="70"></td>
        <td width="426">
		<div class="progress" id="insttimerbardiv">
			<div class="bar" style="width:100%;" id="insttimerbar"></div>
		</div>
		</td>
        <td width="60" valign="top">
            <p align="right"><font face="Verdana"><span style="font-size:14pt; color:black;" id="insttimer"></span></font></p>
        </td>
        <td width="5" valign="top"></td>
        <td width="227" valign="top">
            <p align="left"><font face="Verdana"><span style="font-size:14pt; color:black;" id="step1secrem">seconds remaining</span></font></p>
        </td>
    </tr>
    <tr>
        <td width="800" colspan="5">
            <p align="center"><font face="Verdana" color="#FF3333"><span style="font-size:18pt;" id="insttitle"></span></font></p>
        </td>
    </tr>
    <tr>
        <td width="800" colspan="5">
            <table align="center" id="instructiontable" border="0" width="555" height="450">
            </table>
        </td>
    </tr>
</table>
	
<table border="0" id="step2" width="800" class="financialgametable" align="center">
    <tr>
        <td width="794">
			<div style="text-align:left; width: 800px; height: 150px;">
				<table align="center" border="0" width="794">
					<tr>
						<td width="510" height="95" rowspan="2">
						<div id="grid_8div" class="grid_8" style="text-align:left; width:100px; height: 95px; overflow-x: auto; overflow-y: auto;">	
						<table id="statisticstable" class="fancyTable" cellspacing="0" cellspacing="0">
						</table>
						</div>
						<div class="clear"></div>
						</td>
						<td width="5" height="95" rowspan="2"></td>
						<td width="148" height="40"><font face="Verdana" color="red"><span style="font-size:12pt;">Time Remaining:</span></font></td>
						<td width="101" height="40"><span style="font-size:12pt; color:black;"><font face="Verdana" id="roundtimertext"></font></span></td>
						<td width="8" height="40"></td>
					</tr>
					<tr>
						<td width="253" height="40" colspan="2" valign="top">
						<div class="progress">
						<div class="bar" style="width:100%;" id="roundtimerbar"></div>
						</div>
						</td>
						<td width="8" height="40" valign="top"></td>
					</tr>
					<tr>
					   <td width="788" height="10" colspan="5"></td>
					</tr>
					<tr>
						<td colspan="5">
							<table border="0" width="788">
								<tr>
									<td width="169"></td>
									<td width="169">
										<p align="center">
											<font face="Verdana" color="red"><span id="roundtext" style="font-size:16pt;"></span></font>
										</p>
									</td>
									<td width="169" valign="top">
										<span style="font-size:10pt;"><font face="Verdana" color="black" id="expid"></font></span>
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</div>
			<div style="text-align:left; width: 800px; height: 359px; overflow: auto;">
				<table align="center" border="0" id="midtable" width="775">
				<tr>
					<td width="775">

					<table align="center" id="infotable" border="0">
					<tr><td></td></tr>
					</table>
					</td>
				</tr>
				</table>
			</div>
		</td>
    </tr>
    <tr>
        <td width="794" height="90">
		<div id="butholder" style="height: 90px;">
            <div style="text-align: center; height: 30px; line-height:30px;"><font face="Verdana" ><span style="font-size:12pt; color: #3a87ad;" id="selectedbuttext"></span></font></div>
			<table id="buts" border="0" align="center" width="794">
			</table>
		</div>
		</td>
    </tr>
</table>

<table border="0" id="step3" class="financialgametable" align="center" width="800" height="600">
    <tr>
        <td width="800" colspan="5" height="8"></td>
    </tr>
    <tr>
        <td width="123"></td>
        <td width="373">
		<div class="progress">
			<div class="bar" style="width:100%;" id="resulttimerbar"></div>
		</div>
		</td>
        <td width="60" valign="top">
            <p align="right"><font face="Verdana"><span style="font-size:14pt; color:black;" id="resulttimertext"></span></font></p>
        </td>
        <td width="5" valign="top"></td>
        <td width="227" valign="top">
            <p align="left"><font face="Verdana"><span style="font-size:14pt; color:black;">seconds remaining</span></font></p>
        </td>
    </tr>
    <tr>
        <td width="800" colspan="5">
            <table align="center" border="0" width="555" height="450">
                <tr>
					<td width="555" height="150">
					<table align="center" width="350">
						<tr>
							<td width="350" height="15">
							</td>
						</tr>
						<tr>	
							<td width="352">
							<p align="center">
							<img class="img-inst" align="middle" id="resultimage" src="#">
							</p>
							</td>				
						</tr>
						<tr>	
                                <td width="352" colspan="3" height="86"><div id="resulttextdiv"><div style='margin-left:6px; margin-right:6px; margin-top:5px; margin-bottom:5px; width:338px; height:90px; word-wrap:break-word;'><small id="resulttext" class='smallinst'></small></div></div></td>
						</tr>
					</table>
					</td>
                </tr>
                <tr>
					<td width="555" height="150">
					<table align="center" width="536">
						<tr>
							<td width="536" height="25">
							</td>
						</tr>
						<tr>
							<td width="251" height="13">
								<p align="center"><span style="font-size:12pt; color:black;"><font face="Verdana" id="yourearntext"></font></span></p>
							</td>
							<td width="34" height="126" rowspan="2"></td>
							<td width="250" height="126" rowspan="2">
								<div id="resultdiv" class="grid_8" style="text-align:left; width:250px; height: 126px; overflow-x: auto; overflow-y: auto;">	
									<table id="resulttable" class="fancyTable" cellspacing="0" cellspacing="0">
									</table>
								</div>
							</td>
						</tr>
						<tr>	
							<td width="251" height="90" id="earnresulttd">
								<p align="center"><font face="Verdana"><span style="font-size:24pt;" id="earnresult"></span></font></p>
							</td>
						</tr>
					</table>
					</td>
                </tr>
                <tr>
					<td width="555" height="46">
					<p align="center">
					<table align="center" width="555">
						<tr>			
							<td width="185" height="58">
							</td>
							<td width="185" height="58">
								<p align="center">
								<button id="nextrndbut" type="submit" class="btn btn-primary" onClick=";">
								<i class="icon-arrow-right icon-white"></i> Next Round
								</button>
								</p>
							</td>
							<td width="185" height="58">
							</td>
						</tr>
					</table>
					</p>
					</td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<table border="0" id="step4" class="financialgametable" align="center" width="800" height="600">
    <tr>
        <td width="800" colspan="5" height="8"></td>
    </tr>
    <tr>
        <td width="123"></td>
        <td width="373">
		<div class="progress">
			<div class="bar" style="width:100%;" id="finalresulttimerbar"></div>
		</div>
		</td>
        <td width="60">
            <p align="right"><font face="Verdana"><span style="font-size:14pt; color:black;" id="finalresulttext"></span></font></p>
        </td>
        <td width="5"></td>
        <td width="227">
            <p align="left"><font face="Verdana"><span style="font-size:14pt; color:black;">seconds remaining</span></font></p>
        </td>
    </tr>
    <tr>
        <td width="800" colspan="5">
            <table align="center" border="0" width="800" height="400">
                <tr>
					<td width="800" height="400">
					<table align="center" width="600">
						<tr>
                            <td width="800" height="50"></td>
						</tr>
						<tr>
							<td width="800" height="300">
							    <table align="center" border="0" width="350" height="300">
								<tr>
									<td width="350" height="300">
										<div id="finalresultdiv" class="grid_8" style="text-align:left; width:350px; height: 300px; overflow-x: auto; overflow-y: auto;">	
											<table id="finalresulttable" class="fancyTable" cellspacing="0" cellspacing="0">
											</table>
										</div>
									</td>
								</tr>
								</table>
							</td>
						</tr>
						<tr>
                            <td width="800" height="20"></td>
						</tr>
                        <tr>
                            <td width="800" height="45">
								<p align="center">
									<font face="Verdana" ><span style="font-size:12pt; color: #3a87ad;">
									Thank you for your participation. Click <a href="/stop_test/" onClick='stopPinging();'> here</a>&nbsp;to quit the experiment...
									</span></font>
								</p>
                            </td>
                        </tr>
					</table>
					</td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<table border="0" id="polling" class="financialgametable" align="center" width="800" height="600">
    <tr>
        <td width="800" colspan="5" height="8"></td>
    </tr>
    <tr>
        <td width="123"></td>
        <td width="373">
		<div class="progress">
			<div class="bar" style="width:100%;" id="pollingtimerbar"></div>
		</div>
		</td>
        <td width="60">
            <p align="right"><font face="Verdana"><span style="font-size:14pt; color:black" id="pollingtimertext"></span></font></p>
        </td>
        <td width="5"></td>
        <td width="227">
            <p align="left"><font face="Verdana"><span style="font-size:14pt; color:black">seconds remaining</span></font></p>
        </td>
    </tr>
    <tr>
        <td width="800" colspan="5">
            <table align="center" border="0" width="600" height="400">
                <tr>
					<td width="600" height="400">
					<table align="center" width="600">
						<tr>
                            <td width="600" height="60"></td>
						</tr>
						<tr>
							<td width="600" height="140">
								<p align="center">
								<img class="img-inst" align="middle" id="pollingimage" src="#">
								</p>
							</td>
						</tr>
						<tr>
							<td width="600" height="140">
								<p align="center">
								<font face="Verdana" ><span style="font-size:12pt; color: black;" id="pollingtext"></span></font>
								</p>	
							</td>
						</tr>
                        <tr>
                            <td width="600" height="60">
                            </td>
                        </tr>
					</table>
					</td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<script type="text/javascript">

var instructionsPage;
var expRoundNum;
var Step1Timer;
var Step2Timer;
var Step3Timer;
var Step4Timer;
var timeoutStep1=-1;
var timeoutStep2=-1;
var timeoutStep3=-1;
var timeoutStep4=-1;
var playersForRound=new Array();
var prevRoundPayoffs=new Array();
var prevRoundChoices=new Array();
var totalPayoffs=new Array();
var averagePayoffs=new Array();
var availableChoicesComb=new Array();
var payoffcaption=new Array();
var minimumParticipants;
var scores;
var waitThisRound=true;
var iControlBots = false;
var readyCount=0;
var experimentID=-1;

setRound(1);

function initialize()
{
	minimumParticipants=(Math.log(variables['payoff'][0].length)/Math.log(variables['payoff'].length))+1;
	instructionsPage=1;
	initializeExperimentDetails();
	$('#step1').show();
	$('#step2').hide();
	$('#step3').hide();
	$('#step4').hide();
	$('#polling').hide();
}

function newMove(participant, index) {
  fetchMove(participant, currentRound, index, function(val) {
	if(this.playersForRound.length==0)
	{
		experimentID=parseInt(val.substring(1,14));
		$('#expid').html('Experiment #'+experimentID);
		val=val.substring(15, val.length);
		var tarr=val.split("_");
		for(var p=0;p<tarr.length;p++)
		{
			if(tarr[p].length>0)
			{
				var tarr2=tarr[p].split(",");
				var rarr=new Array();
				for(var m=0;m<tarr2.length;m++)
				{
					if(tarr2[m]!="")
						rarr.push(parseInt(tarr2[m]));
				}
				this.playersForRound.push(rarr);
			}
		}
		setRound(2);
		return;
	}
	if(readyCount<numPlayers)
	{
		if(val=='Ready')
			readyCount++
		if(readyCount==numPlayers)
		{
			setRound(2+expRoundNum);
			if($('#roundtext').html().length==0)
			{
				if(parseInt(variables['Enable Polling'])==1)
				{
					this.waitThisRound=true;
					for(var i=0; i<this.playersForRound[expRoundNum].length; i++)
					{
						if(this.playersForRound[expRoundNum][i]==myid)
							this.waitThisRound=false;
					}
					if(waitThisRound)
					{
						$('#step1').hide();
						$('#polling').show();
					}
					else
					{
						$('#step1').hide();
						$('#step2').show();
					}
				}
				else
				{
					$('#step1').hide();
					$('#step2').show();
				}
				beginExpRound();
			}
		}
		return;
	}
	else	
	{
		var userArr=new Array();
		if(parseInt(variables['Bot_Count'])==0)
		{
			userArr.push(parseInt(participant));
			userArr.push(val);
			this.prevRoundChoices[expRoundNum].push(userArr);
		}
		else
		{
			if(val.indexOf("{")>=0)
			{
				if(val.substring(0,val.indexOf("{")).length>0)
				{
					userArr.push(parseInt(participant));
					userArr.push(val.substring(0,val.indexOf("{")));
					this.prevRoundChoices[expRoundNum].push(userArr);
				}
				var remstr=val.substring(val.indexOf("{"),val.length);
				do
				{
					var curpt=parseInt(remstr.substring(remstr.indexOf("{")+1, remstr.indexOf(",")));
					var curdir=remstr.substring(remstr.indexOf(",")+2, remstr.indexOf("}"));

					var botArr=new Array();
					botArr.push(curpt);
					botArr.push(curdir);
					this.prevRoundChoices[expRoundNum].push(botArr);
					remstr=remstr.substring(remstr.indexOf("}")+1, remstr.length);
				}while(remstr.length>0);
			}
			else
			{
				userArr.push(parseInt(participant));
				userArr.push(val);
				this.prevRoundChoices[expRoundNum].push(userArr);
			}
		}
		
		if(this.prevRoundChoices[expRoundNum].length==minimumParticipants)
		{
			updateStatTables();
			clearTimeout(this.timeoutStep2);
			this.Step2Timer=parseInt(variables['experiment_round_timer']);
			document.getElementById("roundtimerbar").style.width="100%";
			$('#step2').hide();
			if(waitThisRound)
			{
				$('#step3').hide();
				$('#polling').show();
			}
			else
			{
				$('#step3').show();
				$('#polling').hide();
				$('#resulttable').fixedHeaderTable({ altClass: 'odd'});
			}
			countDownStep3();
		}
	}
  });
}

// implement playerDisconnect():
function playerDisconnect(playerNum) {
  // see if I have the lowest live id
	for (var i = 1; i < myid; i++) 
	{
		if (activePlayers[i])
			return;
	}
	iControlBots = true;
	if($('#selectedbuttext').html().indexOf(preprocess(variables['Your_Choice_Text']))>=0)
		submitBotAnswer();
}

function submitBotAnswer()
{
    for (var i = 1; i <= numPlayers; i++)
	{
		if (!activePlayers[i])
		{
			var botWaitThisRound=true;
			for(var j=0; j<this.playersForRound[expRoundNum].length; j++)
			{
				if(this.playersForRound[expRoundNum][j]==i)
					botWaitThisRound=false;
			}
			if(!botWaitThisRound)
				submitBot(i, currentRound, botAnswer());
		}
    }
}

function botAnswer()
{
	if(parseInt(variables['Bot_Type'])==1||expRoundNum==1)
		return variables['Button_'+(Math.floor(Math.random()*parseInt(variables['Button_Count']))+1)+'_Text'];
	if(parseInt(variables['Bot_Type'])==2&&expRoundNum>1)
		return this.prevRoundChoices[expRoundNum-1][Math.floor(Math.random()*this.minimumParticipants)][1];
	return "";
}

function preprocess(str)
{
	while(str.indexOf('%')>=0&&str.indexOf('%',str.indexOf('%')+1)>=0)
	{
		if(str.indexOf('[')>=0&&str.indexOf(']',str.indexOf('[')+1)>=0)
			str=str.substring(0, str.indexOf('%'))+variables[str.substring(str.indexOf('%')+1, str.indexOf('['))][parseInt(str.substring(str.indexOf('[')+1,str.indexOf(']')))-1][parseInt(str.substring(str.indexOf('[', str.indexOf('[')+1)+1,str.indexOf(']', str.indexOf(']')+1)))-1]+str.substring(str.indexOf('%',str.indexOf('%')+1)+1, str.length);
		else
			str=str.substring(0, str.indexOf('%'))+variables[str.substring(str.indexOf('%')+1, str.indexOf('%',str.indexOf('%')+1))]+str.substring(str.indexOf('%',str.indexOf('%')+1)+1, str.length);
	}
	return str;
}

function selectionSort(arr)
{
	for (var i=0; i<arr.length-1; i++) {
		for (var j=i+1; j<arr.length; j++) {
			if($.trim(variables['scoreboard_order'])=="increasing")
			{
				if (arr[i][1] > arr[j][1]) {
					//... Exchange elements
					var tempnm = arr[i][0];
					arr[i][0] = arr[j][0];
					arr[j][0] = tempnm;
					
					var tempstr = arr[i][1];
					arr[i][1] = arr[j][1];
					arr[j][1] = tempstr;
				}
			}
			if($.trim(variables['scoreboard_order'])=="decreasing")
			{
				if (arr[i][1] < arr[j][1]) {
					//... Exchange elements
					var tempnm = arr[i][0];
					arr[i][0] = arr[j][0];
					arr[j][0] = tempnm;
					
					var tempstr = arr[i][1];
					arr[i][1] = arr[j][1];
					arr[j][1] = tempstr;
				}
			}
		}
	}
	return arr;
}

function updateStatTables()
{
	if(this.prevRoundChoices[expRoundNum].length<minimumParticipants)
	{
		$("#resultimage").attr("src", getFile("incomplete.png"));
		$("#resulttext").html(preprocess(variables['incomplete_participation_text']));
		for(var i=1; i<=numPlayers+parseInt(variables['Bot_Count']); i++)
		{
			prevRoundPayoffs[i]=(0).toFixed(2);
			averagePayoffs[i]=parseFloat(parseFloat(totalPayoffs[i])/(expRoundNum)).toFixed(2);
		}
	}
	else
	{
		for(var u=0; u<prevRoundChoices[expRoundNum].length; u++)
		{
			var figuredComb=new Array();
			var userChoice;
			for(var i=0; i<minimumParticipants; i++)
			{
				if(this.prevRoundChoices[expRoundNum][i][0]!=this.prevRoundChoices[expRoundNum][u][0])
					figuredComb.push(this.prevRoundChoices[expRoundNum][i][1]);
				else
					userChoice=this.prevRoundChoices[expRoundNum][i][1];
			}
			var mcri=matchedCombRowIndex(userChoice);
			var mcci=matchedCombColumnIndex(figuredComb, true);
			if(this.prevRoundChoices[expRoundNum][u][0]==myid)
			{
				for(var i=1; i<=parseInt(variables['information_row_count']); i++)
				{
					for(var j=1; j<=parseInt(variables['information_column_count']); j++)
					{
						if(variables["information_row"+i+"_column"+j+"_payoff_cells"].indexOf("("+(mcri+1)+","+(mcci+1)+")")>=0)
						{
							$("#resultimage").attr("src", getFile(variables["information_row"+i+"_column"+j+"_image"]));
							$("#resulttext").html(preprocess(variables["information_row"+i+"_column"+j+"_outcome_text"]));
							break;
						}
					}
				}
			}
			prevRoundPayoffs[this.prevRoundChoices[expRoundNum][u][0]]=parseFloat(variables['payoff'][mcri][mcci]).toFixed(2);
			totalPayoffs[this.prevRoundChoices[expRoundNum][u][0]]=(parseFloat(totalPayoffs[this.prevRoundChoices[expRoundNum][u][0]])+parseFloat(variables['payoff'][mcri][mcci])).toFixed(2);
			averagePayoffs[this.prevRoundChoices[expRoundNum][u][0]]=parseFloat(parseFloat(totalPayoffs[this.prevRoundChoices[expRoundNum][u][0]])/(expRoundNum)).toFixed(2);
		}
	}
	$('#earnresult').html(totalPayoffs[myid]);

	this.scores=new Array();
	for(var i=0; i<numPlayers+parseInt(variables['Bot_Count']); i++)
	{
		scores[i]=new Array();
		scores[i].push(i+1);
		scores[i].push(parseFloat(totalPayoffs[i+1]));
	}
	this.scores=selectionSort(this.scores);

	if(this.prevRoundChoices[expRoundNum].length==minimumParticipants)
	{
		var resulttablehtml="<thead><tr style=\"height:25px; line-height:25px;\"><th><span style='padding-left:7px;'>Rank</span></th><th><span style='padding-left:7px;'>Players</span></th><th><span style='padding-left:7px;'>Score Board</span></th></tr></thead><tbody>";
		for(var i=0; i<numPlayers+parseInt(variables['Bot_Count']); i++)
		{
			resulttablehtml+=("<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>"+(i+1)+"</span></td><td><span style='padding-left:7px;'>");
			if(scores[i][0]<=numPlayers)
			{
				if(scores[i][0]==myid)
					resulttablehtml+=("You</span></td><td><span style='padding-left:7px;'>"+scores[i][1].toFixed(2)+"</span></td></tr>");
				else
					resulttablehtml+=(getName(scores[i][0])+"</span></td><td><span style='padding-left:7px;'>"+scores[i][1].toFixed(2)+"</span></td></tr>");
			}
			else
				resulttablehtml+=(("Bot "+(scores[i][0]-numPlayers))+"</span></td><td><span style='padding-left:7px;'>"+scores[i][1].toFixed(2)+"</span></td></tr>");
		}
		resulttablehtml+="</tbody>";
		$('#resulttable').html(resulttablehtml);
		if(this.waitForRound==false)
			$('#resulttable').fixedHeaderTable({ altClass: 'odd'});
	}

	var statstablehtml="<thead><tr style=\"height:25px; line-height:25px;\"><th><span style='padding-left:7px;'>Players</span></th>";
	var statstablewidth=110;
	if(parseInt(variables['Prev_Rnd_Payoff'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Prev_Rnd_Payoff_Text'])+"</span></th>";
	}
	if(parseInt(variables['Prev_Rnd_Choice'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Prev_Rnd_Choice_Text'])+"</span></th>";
	}
	if(parseInt(variables['Total_Payoff'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Total_Payoff_Text'])+"<span></th>";
	}
	if(parseInt(variables['Avg_Payoff'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Avg_Payoff_Text'])+"</span></th>";
	}
	document.getElementById("grid_8div").style.width=statstablewidth+"px";
	statstablehtml+="</tr></thead><tbody>";

	for(var i=1; i<=numPlayers; i++)
	{
		if(i==myid)
		{
			statstablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>You</span></td>";
			if(parseInt(variables['Prev_Rnd_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>"+prevRoundPayoffs[i]+"<span></td>";
			if(parseInt(variables['Prev_Rnd_Choice'])==1)
			{
				if(this.prevRoundChoices[expRoundNum].length<minimumParticipants)
					statstablehtml+="<td><span style='padding-left:7px;'>N/A</span></td>";
				else
				{
					var choiceFound=false;
					for(var k=0; k<this.prevRoundChoices[expRoundNum].length; k++)
					{
						if(this.prevRoundChoices[expRoundNum][k][0]==myid)
						{
							choiceFound=true;
							statstablehtml+="<td><span style='padding-left:7px;'>"+this.prevRoundChoices[expRoundNum][k][1]+"</span></td>";
							break;
						}
					}
					if(!choiceFound)
						statstablehtml+="<td><span style='padding-left:7px;'>N/A</span></td>";
				}
			}
			if(parseInt(variables['Total_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>"+totalPayoffs[i]+"</span></td>";
			if(parseInt(variables['Avg_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>"+averagePayoffs[i]+"</span></td>";
			statstablehtml+="</tr>";
		}
	}

	for(var i=1; i<=numPlayers+parseInt(variables['Bot_Count']); i++)
	{
		if(i!=myid)
		{
			if(i<=numPlayers)
				statstablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>"+getName(i)+"</span></td>";
			else
				statstablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>Bot "+(i-numPlayers)+"</span></td>";
			if(parseInt(variables['Prev_Rnd_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>"+prevRoundPayoffs[i]+"</span></td>";
			if(parseInt(variables['Prev_Rnd_Choice'])==1)
			{
				if(this.prevRoundChoices[expRoundNum].length<minimumParticipants)
					statstablehtml+="<td><span style='padding-left:7px;'>N/A</span></td>";
				else
				{
					var choiceFound=false;
					for(var k=0; k<this.prevRoundChoices[expRoundNum].length; k++)
					{
						if(this.prevRoundChoices[expRoundNum][k][0]==i)
						{
							choiceFound=true;
							statstablehtml+="<td><span style='padding-left:7px;'>"+this.prevRoundChoices[expRoundNum][k][1]+"</span></td>";
							break;
						}
					}
					if(!choiceFound)
						statstablehtml+="<td><span style='padding-left:7px;'>N/A</span></td>";
				}
			}
			if(parseInt(variables['Total_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>"+totalPayoffs[i]+"</span></td>";
			if(parseInt(variables['Avg_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>"+averagePayoffs[i]+"</span></td>";
			statstablehtml+="</tr>";
		}
	}

	statstablehtml+="</tbody>";
	$('#statisticstable').html(statstablehtml);
	if(this.waitForRound==false)
		$('#statisticstable').fixedHeaderTable({ altClass: 'odd'});
}

function countDownStep1(){  
	 if (this.Step1Timer <=0){
		if($.trim($('#readyp').html())!='Please wait for others...')
			submit('Ready');
	 }else{  
		this.Step1Timer--;
		if(parseInt(variables['instruction_lastseconds_timer'])>=this.Step1Timer)
		{
			$('#insttimerbardiv').show();
			$('#insttimer').show();
			$('#step1secrem').html('seconds remaining');
		}
		else
		{
			$('#insttimerbardiv').hide();
			$('#insttimer').hide();
			$('#step1secrem').html('&nbsp;');
		}
		document.getElementById("insttimerbar").style.width=(this.Step1Timer*100/parseInt(variables['instruction_lastseconds_timer']+""))+"%";
		document.getElementById("insttimer").innerHTML = this.Step1Timer;
		this.timeoutStep1=setTimeout("countDownStep1()", 1000);
	 }  
}

function getInstructions(instpage)
{
	$('#insttitle').html("Instructions - Part "+instpage+"/"+Math.ceil(parseInt(variables['instruction_count'])/3));
	var instructionhtml="";
	for(var i=(instpage-1)*3+1; i<=(instpage-1)*3+3&&i<=parseInt(variables['instruction_count']); i++)
	{
		var instimg=(variables['instruction_image_'+i]&&variables['instruction_image_'+i].length>0)?variables['instruction_image_'+i]:"nophoto.png";
		if(i%2==1)
			instructionhtml+="<tr><td width=\"555\" height=\"150\"><table align=\"center\" width=\"555\"><tr><td width=\"140\" height=\"150\"><img src=\""+getFile(instimg)+"\" class=\"img-inst\"></td><td width=\"15\" height=\"150\"></td><td width=\"400\" height=\"150\" colspan=\"4\"><div id=\"instructiontextdiv\"><div style=\"word-wrap:break-word; width: 385px; height: 130px; margin-left:7.5px; margin-right:7.5px; margin-top:5px; margin-bottom:5px;\"><small id=\"instructiontext"+i+"\" class='smallinst'>"+preprocess(variables['instruction_text_'+i])+"</small></div></div></td></tr></table></td></tr>"
		else
			instructionhtml+="<tr><td width=\"555\" height=\"150\"><table align=\"center\" width=\"555\"><tr><td width=\"400\" height=\"150\"><div id=\"instructiontextdiv\"><div style=\"word-wrap:break-word; width: 385px; height: 130px; margin-left:7.5px; margin-right:7.5px; margin-top:5px; margin-bottom:5px;\"><small id=\"instructiontext"+i+"\" class='smallinst'>"+preprocess(variables['instruction_text_'+i])+"</small></div></div></td><td width=\"15\" height=\"150\"></td><td width=\"140\" height=\"150\"><img src=\""+getFile(instimg)+"\" class=\"img-inst\"></td></tr></table></td></tr>"
	}
	//instructionhtml+="<tr><td width=\"555\" height=\"46\"><table align=\"center\" width=\"555\"><tr><td width=\"185\" height=\"46\"><p align=\"left\"><button id=\"previnsbut\" type=\"submit\" class=\"btn btn-primary\" onClick=\"instructionsPage--;getInstructions(instructionsPage);\"><i class=\"icon-arrow-left icon-white\"></i> Previous</button></p></td><td width=\"185\" height=\"46\"><p align=\"center\"></p></td><td width=\"185\" height=\"46\"><p align=\"right\"><button id=\"nextinsbut\" type=\"submit\" class=\"btn btn-primary\" onClick=\"instructionsPage++;getInstructions(instructionsPage);;\"><i class=\"icon-arrow-right icon-white\"></i>Next</button></p></td></tr></table></td></tr>";
	instructionhtml+="<tr><td width=\"555\" height=\"46\"><table align=\"center\" width=\"555\"><tr><td width=\"185\" height=\"46\"><p align=\"left\"><button id=\"previnsbut\" type=\"submit\" class=\"btn btn-primary\" onClick=\"instructionsPage--;getInstructions(instructionsPage);\"><i class=\"icon-arrow-left icon-white\"></i> Previous</button></p></td><td width=\"185\" height=\"46\"><p align=\"center\"><font face=\"Verdana\"><span style=\"font-size:10pt; color:black\" id=\"readyp\"><button id=\"begininsbut\" type=\"submit\" class=\"btn btn-primary\" onClick=\"submit('Ready');$('#begininsbut').hide();$('#readyp').html('Please wait for others...');\"><i class=\"icon-play-circle icon-white\"></i> Ready</button></span></font></p></td><td width=\"185\" height=\"46\"><p align=\"right\"><button id=\"nextinsbut\" type=\"submit\" class=\"btn btn-primary\" onClick=\"instructionsPage++;getInstructions(instructionsPage);\"><i class=\"icon-arrow-right icon-white\"></i>Next</button></p></td></tr></table></td></tr>";
	$("#instructiontable").html(instructionhtml);
	if(instpage==Math.ceil(parseInt(variables['instruction_count'])/3))
	{
		$('#nextinsbut').hide();
		$('#begininsbut').show();
	}
	else
		$('#begininsbut').hide();
	if(instpage>1)
		$('#previnsbut').show();
	else
		$('#previnsbut').hide();
}

function countDownStep2()
{  
	 if (this.Step2Timer <=0){
		updateStatTables();
		clearTimeout(this.timeoutStep2);
	 	this.Step2Timer=parseInt(variables['experiment_round_timer']);
		if(parseInt(variables['Enable Polling'])==1&&this.waitThisRound==true)
		{
			document.getElementById("pollingtimerbar").style.width="100%";
		}
		else
		{
			document.getElementById("roundtimerbar").style.width="100%";
			$('#step2').hide();
			$('#step3').show();
		}
		countDownStep3();
	 }else{  
		this.Step2Timer--;
		document.getElementById("pollingtimerbar").style.width=((this.Step2Timer+parseInt(variables['result_timer']+""))*100/(parseInt(variables['experiment_round_timer']+"")+parseInt(variables['result_timer']+"")))+"%";
		document.getElementById("pollingtimertext").innerHTML = (this.Step2Timer+parseInt(variables['result_timer']+""));
		document.getElementById("roundtimerbar").style.width=(this.Step2Timer*100/parseInt(variables['experiment_round_timer']+""))+"%";
		document.getElementById("roundtimertext").innerHTML = this.Step2Timer+" seconds"; 
		this.timeoutStep2=setTimeout("countDownStep2()", 1000);
	 }  
}

function recursivepayoffcaption(begin, end, k)
{
	for (var s = 1; s <= k; s++) 
	{
		if (begin == end) 
		{
			var tempord=new Array();
			for(var j=0; j<payoffcaption.length; j++)
				tempord.push(payoffcaption[j]);
			this.availableChoicesComb.push(tempord);
			return;
		}
		else
			payoffcaption[begin]=preprocess(variables['Button_'+s+'_Text']);
		recursivepayoffcaption(begin+1, end, k);
	}
	
	return;
}

function matchedCombRowIndex(playerChoice)
{
	if(playerChoice==preprocess(variables['Button_1_Text']))
		return 0;
	if(playerChoice==preprocess(variables['Button_2_Text']))
		return 1;
	if(playerChoice==preprocess(variables['Button_3_Text']))
		return 2;
	if(playerChoice==preprocess(variables['Button_4_Text']))
		return 3;
	if(playerChoice==preprocess(variables['Button_1_Text']))
		return 4;
		
	return -1
}

function matchedCombColumnIndex(arr, ratiovalid)
{
	for(var y=0; y<availableChoicesComb.length; y++)
	{
		var bl=true;
		for(var z=0; z<minimumParticipants-1; z++)
		{
			if(arr[z]!=availableChoicesComb[y][z])
				bl = false;
		}
		if(bl)
			return y;
	}
	return -1;
}

function countDownStep3(){  
	 if (this.Step3Timer <=0){
		clearTimeout(this.timeoutStep3);
		if(expRoundNum<parseInt(variables['total_rounds_count']))
		{
			this.Step3Timer=parseInt(variables['result_timer']);
			if(parseInt(variables['Enable Polling'])==1)
				document.getElementById("pollingtimerbar").style.width="100%";
			else
				document.getElementById("resulttimerbar").style.width="100%";
			expRoundNum++;
			setRound(2+expRoundNum);
			if(parseInt(variables['Enable Polling'])==1)
			{
				this.waitThisRound=true;
				for(var i=0; i<this.playersForRound[expRoundNum-1].length; i++)
				{
					if(this.playersForRound[expRoundNum-1][i]==myid)
						this.waitThisRound=false;
				}
				if(waitThisRound)
				{
					$('#step3').hide();
					$('#polling').show();
				}
				else
				{
					$('#step3').hide();
					$('#polling').hide();
					$('#step2').show();
				}
			}
			else
			{
				$('#step3').hide();
				$('#polling').hide();
				$('#step2').show();
			}
			beginExpRound();
		}
		else
		{
			$('#step3').hide();
			$('#polling').hide();
			$('#step4').show();
			var finalresulttablehtml="<thead><tr style=\"height:25px; line-height:25px;\"><th><span style='padding-left:7px;'>Rank</span></th><th><span style='padding-left:7px;'>Players</span></th><th><span style='padding-left:7px;'>Score Board</span></th></tr></thead><tbody>";
			for(var i=0; i<numPlayers+parseInt(variables['Bot_Count']); i++)
			{
				finalresulttablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>"+(i+1)+"</span></td><td><span style='padding-left:7px;'>";
				if(scores[i][0]<=numPlayers)
				{
					if(scores[i][0]==myid)
						finalresulttablehtml+="You</span></td><td><span style='padding-left:7px;'>"+scores[i][1].toFixed(2)+"</span></td></tr>";
					else
						finalresulttablehtml+=getName(scores[i][0])+"</span></td><td><span style='padding-left:7px;'>"+scores[i][1].toFixed(2)+"</span></td></tr>";
				}
				else
					finalresulttablehtml+=("Bot "+(scores[i][0]-numPlayers))+"</span></td><td><span style='padding-left:7px;'>"+scores[i][1].toFixed(2)+"</span></td></tr>";
			}
			finalresulttablehtml+="</tbody>";
			$('#finalresulttable').html(finalresulttablehtml);
			$('#finalresulttable').fixedHeaderTable({ altClass: 'odd'});
			countDownStep4();
		}
	 }else{  
		this.Step3Timer--;
		document.getElementById("pollingtimerbar").style.width=(this.Step3Timer*100/(parseInt(variables['experiment_round_timer']+"")+parseInt(variables['result_timer']+"")))+"%";
		document.getElementById("pollingtimertext").innerHTML = this.Step3Timer;
		document.getElementById("resulttimerbar").style.width=(this.Step3Timer*100/parseInt(variables['result_timer']+""))+"%";
		document.getElementById("resulttimertext").innerHTML = this.Step3Timer;
		this.timeoutStep3=setTimeout("countDownStep3()", 1000);
	 }  
}

function countDownStep4(){  
	 if (this.Step4Timer <=0){
		clearTimeout(this.timeoutStep4);
		quit();
		var myurl = "http://"+window.location.host+"/stop_test";
		window.location = myurl;
	 }else{  
		this.Step4Timer--;
		document.getElementById("finalresulttimerbar").style.width=(this.Step4Timer*100/parseInt(variables['end_game_timer']+""))+"%";
		document.getElementById("finalresulttext").innerHTML = this.Step4Timer; 
		this.timeoutStep3=setTimeout("countDownStep4()", 1000);
	 }  
} 

function beginExpRound()
{
	$('#roundtext').html("Round "+(expRoundNum)+" of "+variables['total_rounds_count']);
	countDownStep2();
	setupButtons();
	
	if(iControlBots&&waitThisRound)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			var botVal="";
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
			submit(botVal);
		}
	}
}

function setupButtons()
{
	var butshtml="<tr><td width=\"20\"></td><td width=\"140\"><div id=\"but1\" style=\"width: 140px; height: 60px; position:relative;\"></div></td><td width=\"15\"></td><td width=\"140\"><div id=\"but2\" style=\"width: 140px; height: 60px; position:relative;\"></div></td><td width=\"15\"></td><td width=\"140\"><div id=\"but3\" style=\"width: 140px; height: 60px; position:relative;\"></div></td><td width=\"15\"></td><td width=\"140\"><div id=\"but4\" style=\"width: 140px; height: 60px; position:relative;\"></div></td><td width=\"15\"></td><td width=\"140\"><div id=\"but5\" style=\"width: 140px; height: 60px; position:relative;\"></div></td><td width=\"20\"></td></tr>";
	$("#buts").html(butshtml);
	$('#selectedbuttext').html("&nbsp;");
	if(parseInt(variables['Button_Count'])==2)
	{
		$("#but2").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but2_2Pressed();$('#but4').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_1_Text'])+"</a></p>");
		$("#but4").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but4_2Pressed();$('#but2').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_2_Text'])+"</a></p>");
	}
	else if(parseInt(variables['Button_Count'])==3)
	{
		$("#but2").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but2_3Pressed();$('#but3').html('');$('#but4').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_1_Text'])+"</a></p>");
		$("#but3").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but3_3Pressed();$('#but2').html('');$('#but4').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_2_Text'])+"</a></p>");
		$("#but4").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but4_3Pressed();$('#but2').html('');$('#but3').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_3_Text'])+"</a></p>");
	}
	else if(parseInt(variables['Button_Count'])==4)
	{
		$("#buts").html("<tr><td width=\"24\"></td><td width=\"170\"><div id=\"but1\" style=\"width: 170px; height: 60px; position:relative;\"></div></td><td width=\"24\"></td><td width=\"170\"><div id=\"but2\" style=\"width: 170px; height: 60px; position:relative;\"></div></td><td width=\"24\"></td><td width=\"170\"><div id=\"but4\" style=\"width: 170px; height: 60px; position:relative;\"></div></td><td width=\"24\"></td><td width=\"170\"><div id=\"but5\" style=\"width: 170px; height: 60px; position:relative;\"></div></td><td width=\"24\"></td></tr>");
		$("#but1").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but1_4Pressed();$('#but2').html('');$('#but4').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_1_Text'])+"</a></p>");
		$("#but2").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but2_4Pressed();$('#but1').html('');$('#but4').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_2_Text'])+"</a></p>");
		$("#but4").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but4_4Pressed();$('#but1').html('');$('#but2').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_3_Text'])+"</a></p>");
		$("#but5").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but5_4Pressed();$('#but1').html('');$('#but2').html('');$('#but4').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_4_Text'])+"</a></p>");
	}
	else if(parseInt(variables['Button_Count'])==5)
	{
		$("#but1").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but1_5Pressed();$('#but2').html('');$('#but3').html('');$('#but4').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_1_Text'])+"</a></p>");
		$("#but2").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but2_5Pressed();$('#but1').html('');$('#but3').html('');$('#but4').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_2_Text'])+"</a></p>");
		$("#but3").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but3_5Pressed();$('#but1').html('');$('#but2').html('');$('#but4').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_3_Text'])+"</a></p>");
		$("#but4").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but4_5Pressed();$('#but1').html('');$('#but2').html('');$('#but3').html('');$('#but5').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_4_Text'])+"</a></p>");
		$("#but5").html("<p align=\"center\"><a class=\"mybutton\" onclick=\"but5_5Pressed();$('#but1').html('');$('#but2').html('');$('#but3').html('');$('#but4').html('');\" OnMouseOver=\"this.style.cursor='pointer'\">"+preprocess(variables['Button_5_Text'])+"</a></p>");
	}
}

function initializeExperimentDetails()
{
	//begin but, next round but, syncronization?
	//$('#begininsbut').hide();
	$('#nextrndbut').hide();
	
	if(parseInt(variables['Bot_Count'])>0&&myid==1)
		iControlBots = true;
	$('#yourearntext').html(preprocess(variables['Total_Payoff_Text']));
	$('#pollingtext').html(preprocess(variables['Polling_Text']));
	$("#pollingimage").attr("src", getFile("wait.png"));

	expRoundNum=1;
	this.Step1Timer=parseInt(variables['instruction_timer'])+1;
	this.Step2Timer=parseInt(variables['experiment_round_timer'])+1;
	this.Step3Timer=parseInt(variables['result_timer'])+1;
	this.Step4Timer=parseInt(variables['end_game_timer'])+1;
	
	for(var m=0; m<minimumParticipants-1; m++)
		payoffcaption.push(preprocess(variables['Button_1_Text']));
	recursivepayoffcaption(0, minimumParticipants-1, parseInt(variables['Button_Count']));
	
	for(var i=1; i<=parseInt(variables['total_rounds_count']); i++)
		this.prevRoundChoices[i]=new Array();
		
	for(var i=1; i<=numPlayers+parseInt(variables['Bot_Count']); i++)
	{
		prevRoundPayoffs[i]=(0).toFixed(2);
		totalPayoffs[i]=(0).toFixed(2);
		averagePayoffs[i]=(0).toFixed(2);
	}
	
	var resulttablehtml="<thead><tr style=\"height:25px; line-height:25px;\"><th><span style='padding-left:7px;'>Rank</span></th><th><span style='padding-left:7px;'>Players</span></th><th><span style='padding-left:7px;'>Score Board</span></th></tr></thead><tbody>";
	for(var i=0; i<numPlayers+parseInt(variables['Bot_Count']); i++)
	{
		resulttablehtml+=("<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>"+(i+1)+"</span></td><td><span style='padding-left:7px;'>");
		if(i<numPlayers)
		{
			if(i+1==myid)
				resulttablehtml+=("You</span></td><td><span style='padding-left:7px;'>"+(0).toFixed(2)+"</span></td></tr>");
			else
				resulttablehtml+=(getName(i+1)+"</span></td><td><span style='padding-left:7px;'>"+(0).toFixed(2)+"</span></td></tr>");
		}
		else
			resulttablehtml+=(("Bot "+(i+1-numPlayers))+"</span></td><td><span style='padding-left:7px;'>"+(0).toFixed(2)+"</span></td></tr>");
	}
	resulttablehtml+="</tbody>";
	$('#resulttable').html(resulttablehtml);
	$('#resulttable').fixedHeaderTable({ altClass: 'odd'});

	getInstructions(instructionsPage);
	$('#insttimer').html(variables['instruction_timer']);
	countDownStep1();

	var statstablehtml="<thead><tr style=\"height:25px; line-height:25px;\"><th><span style='padding-left:7px;'>Players</span></th>";
	var statstablewidth=110;
	if(parseInt(variables['Prev_Rnd_Payoff'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Prev_Rnd_Payoff_Text'])+"</span></th>";
	}
	if(parseInt(variables['Prev_Rnd_Choice'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Prev_Rnd_Choice_Text'])+"</span></th>";
	}
	if(parseInt(variables['Total_Payoff'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Total_Payoff_Text'])+"</span></th>";
	}
	if(parseInt(variables['Avg_Payoff'])==1)
	{
		statstablewidth+=100;
		statstablehtml+="<th><span style='padding-left:7px;'>"+preprocess(variables['Avg_Payoff_Text'])+"</span></th>";
	}
	document.getElementById("grid_8div").style.width=statstablewidth+"px";
	statstablehtml+="</tr></thead><tbody>";
	for(var i=1; i<=numPlayers; i++)
	{
		if(i==myid)
		{
			statstablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>You</span></td>";
			if(parseInt(variables['Prev_Rnd_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>0</span></td>";
			if(parseInt(variables['Prev_Rnd_Choice'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>N/A</span></td>";
			if(parseInt(variables['Total_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>0</span></td>";
			if(parseInt(variables['Avg_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>0</span></td>";
			statstablehtml+="</tr>";
		}
	}
	for(var i=1; i<=numPlayers+parseInt(variables['Bot_Count']); i++)
	{
		if(i!=myid)
		{
			if(i<=numPlayers)
				statstablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>"+getName(i)+"</span></td>";
			else
				statstablehtml+="<tr style=\"height:25px; line-height:25px;\"><td><span style='padding-left:7px;'>Bot "+(i-numPlayers)+"</span></td>";
			if(parseInt(variables['Prev_Rnd_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>0</span></td>";
			if(parseInt(variables['Prev_Rnd_Choice'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>N/A</span></td>";
			if(parseInt(variables['Total_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>0</span></td>";
			if(parseInt(variables['Avg_Payoff'])==1)
				statstablehtml+="<td><span style='padding-left:7px;'>0</span></td>";
			statstablehtml+="</tr>";
		}
	}
	statstablehtml+="</tbody>";
	$('#statisticstable').html(statstablehtml);
	$('#statisticstable').fixedHeaderTable({ altClass: 'odd'});

	var infohtml="";
	for(var i=1; i<=parseInt(variables['information_row_count']); i++)
	{
		infohtml+="<tr>";
		if(i>1)
		{
			for(var j=1; j<=parseInt(variables['information_column_count']); j++)
				infohtml+="<td width=\"352\" height=\"11\" colspan=\"3\"></td>";
			infohtml+="</tr><tr>";
		}
		for(var j=1; j<=parseInt(variables['information_column_count']); j++)
		{
			var infimg=(variables['information_row'+i+'_column'+j+'_image']&&variables['information_row'+i+'_column'+j+'_image'].length>0)?variables['information_row'+i+'_column'+j+'_image']:"nophoto.png";
			infohtml+="<td width=\"352\" colspan=\"3\"><div style=\"width:100px; height:100px; margin-left:126px;\"><img class=\"infoimg\" id=\"infoimage"+j+"\" src=\""+getFile(infimg)+"\"><div></td>";
		}
		infohtml+="</tr><tr><td width=\"352\" height=\"6\" colspan=\"3\"></td></tr><tr>";
		for(var j=1; j<=parseInt(variables['information_column_count']); j++)
			infohtml+="<td width=\"18\" id=\"infotexttdmargin\"></td><td width=\"302\" id=\"infotexttd\"><div style='margin-left:5px; margin-right:5px; margin-top:5px; margin-bottom:5px; width:292px; word-wrap:break-word;'><small id=\"infotext"+j+"\" class='smallinfo'>"+((variables['information_row'+i+'_column'+j+'_text'])?preprocess(variables['information_row'+i+'_column'+j+'_text']):"")+"</small></div></td><td width=\"18\" id=\"infotexttdmargin\" ></td>";
		infohtml+="</tr>";
	}
	$("#infotable").html(infohtml);
	
	setupButtons();
	
	//send the information of which players will play in which rounds
	if(myid==1)
	{
		var roundsstr="";
		for(var m=0; m <parseInt(variables['total_rounds_count']); m++)
		{
			var orderarr=new Array();
			var tmpnm=Math.floor(Math.random()*(numPlayers+parseInt(variables['Bot_Count'])))+1;
			orderarr.push(tmpnm);
			for(var k=1; k<=minimumParticipants-1; k++)
			{
				do{
					tmpnm=Math.floor(Math.random()*(numPlayers+parseInt(variables['Bot_Count'])))+1;
				}
				while(orderExists(orderarr, tmpnm));
				orderarr.push(tmpnm);
			}

			for(var g=0; g<orderarr.length; g++)
			{
				if(g==orderarr.length-1)
					roundsstr+=(orderarr[g]+"_");
				else
					roundsstr+=(orderarr[g]+",");
			}
		}

		//unique experiment id
		roundsstr="["+((new Date()).getTime())+"]"+roundsstr;
		
		submit(roundsstr);
	
	}
}

function orderExists(arr, nm)
{
	for(var i=0; i<arr.length; i++)
	{
		if(arr[i]==nm)
			return true;
	}
	return false;
}

function but2_2Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(preprocess(variables['Button_1_Text'])+botVal);
	$('#but2').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_1_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_1_Text']));
	$("#but2").animate({left:'155px'});
}

function but4_2Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{		
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_2_Text']+botVal);
	$('#but4').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_2_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_2_Text']));
	$("#but4").animate({right:'155px'});
}

function but2_3Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_1_Text']+botVal);
	$('#but2').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_1_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_1_Text']));
	$("#but2").animate({left:'155px'});
}

function but3_3Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_2_Text']+botVal);
	$('#but3').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_2_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_2_Text']));
}

function but4_3Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_3_Text']+botVal);
	$('#but4').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_3_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_3_Text']));
	$("#but4").animate({right:'155px'});
}

function but1_4Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_1_Text']+botVal);
	$('#but1').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_1_Text']+"</a></p>"));
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_1_Text']));
	$("#but1").animate({left:'282px'});
}

function but2_4Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_2_Text']+botVal);
	$('#but2').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_2_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_2_Text']));
	$("#but2").animate({left:'95px'});
}

function but4_4Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_3_Text']+botVal);
	$('#but4').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_3_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_3_Text']));
	$("#but4").animate({right:'95px'});
}

function but5_4Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_4_Text']+botVal);
	$('#but5').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_4_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_4_Text']));
	$("#but5").animate({right:'282px'});
}

function but1_5Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_1_Text']+botVal);
	$('#but1').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_1_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_1_Text']));
	$("#but1").animate({left:'310px'});
}

function but2_5Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_2_Text']+botVal);
	$('#but2').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_2_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_2_Text']));
	$("#but2").animate({left:'155px'});
}

function but3_5Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_3_Text']+botVal);
	$('#but3').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_3_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_3_Text']));
}

function but4_5Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_4_Text']+botVal);
	$('#but4').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_4_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_4_Text']));
	$("#but4").animate({right:'155px'});
}

function but5_5Pressed()
{
	var botVal="";
	if(iControlBots)
	{
		if(parseInt(variables['Bot_Count'])==0) // send bot answer for disconnected player
			submitBotAnswer();
		else
		{
			for(var i=1; i<=parseInt(variables['Bot_Count']); i++)
			{
				var botIncluded=false;
				for(var j=0; j<this.playersForRound[expRoundNum-1].length; j++)
				{
					if(this.playersForRound[expRoundNum-1][j]==numPlayers+i)
						botIncluded=true;
				}
				if(botIncluded)
					botVal+=("{"+(numPlayers+i)+", "+botAnswer()+"}");
			}
		}
	}
	submit(variables['Button_5_Text']+botVal);
	$('#but5').html("<p align='center'><a class='mybuttonpressed'> "+preprocess(variables['Button_5_Text'])+"</a></p>");
	$('#selectedbuttext').html(preprocess(variables['Your_Choice_Text'])+preprocess(variables['Button_5_Text']));
	$("#but5").animate({right:'310px'});
}

</script>


